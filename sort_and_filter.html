<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Sort and filter</title>
		<style>
			section{
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(15em, 1fr));
				grid-gap: .5em;
			}
			section h1{
				grid-column: 1/-1;
				text-transform: capitalize;
			}
			article{
				background: #cde;
				padding: 1em;
			}
			select option{
				text-transform: capitalize;
			}
		</style>
	</head>
	<body>
		<select id="catSelect"></select>
		<select id="filtSelect"></select>
		<main></main>
		<script>
			const catLink = "http://kea-alt-del.dk/t5/api/categories";
			const pListLink = "http://kea-alt-del.dk/t5/api/productlist";
			const main = document.querySelector("main");
			const catSelect = document.querySelector("#catSelect");
			const filtSelect = document.querySelector("#filtSelect");
			let pList = [];
			let sublist = [];
			let catlist = [];

			catSelect.addEventListener("change", event=>{
				const filt = event.target.value;
				main.textContent="";
				sort("category", filt);
			});

			filtSelect.addEventListener("change", event=>{
				const prop = event.target.value;
				main.textContent="";
				sort(prop, null);
			});

			fetch(pListLink).then(result=>result.json()).then(data=>save(data));

			function save(data){
				pList = data;
				createCats();
				Object.entries(data[0]).forEach(elm=>{
					if(typeof(elm[1])!="string" && elm[0]!="price"){
						let option = createLinks(elm[0], elm[0], null);
						filtSelect.appendChild(option);
					}
				});
			}

			function createCats(){
				let option = createLinks("all", "all");
				catSelect.appendChild(option);
				fetch(catLink).then(result=>result.json()).then(data=>{
					catlist = data;
					data.forEach(elm=>{
						option = createLinks("category", elm, elm);
						sort("category", elm);
						catSelect.appendChild(option);
					});
				});
			}

			function createLinks(prop, text, filt){
				const option = document.createElement("option");
				option.href = "#";
				option.textContent = text;
				option.value = text;
				return option;
			}

			function sort(prop, myfilter){
				const h1 = document.createElement("h1");
				const section = document.createElement("section");
				if(myfilter){
					h1.textContent = myfilter;
					sublist = pList.filter(product=>product[prop] == myfilter);
				}else if(prop=="all"){
					console.log(catlist);
					catlist.forEach(elm=>{
						sort("category", elm);
					});
				}else{
					h1.textContent = prop;
					sublist = pList.filter(product=>product[prop]);
				}
				sublist.forEach(product=>{
					const article = document.createElement("article");
					article.textContent = product.name;
					section.appendChild(article);
				});
				section.prepend(h1);
				main.appendChild(section);
			}
		</script>
	</body>
</html>
